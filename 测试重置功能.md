# 测试班级状态自动重置功能

## 问题解决

已为 `dailyReset` 云函数创建了缺失的 `package.json` 文件，现在需要重新部署。

## 部署步骤

1. **重新部署云函数**
   ```
   在微信开发者工具中：
   右键 cloudfunctions/dailyReset 文件夹
   → 选择"上传并部署：云端安装依赖"
   → 等待部署完成
   ```

2. **验证定时器配置**
   - 定时器配置：`"0 0 0 * * * *"` (每天0点执行)
   - 触发器名称：`dailyResetTrigger`

## 测试方法

### 方法1：手动调用测试
```javascript
// 在小程序中调用测试
wx.cloud.callFunction({
  name: 'dailyReset',
  data: {}
}).then(result => {
  console.log('手动重置结果:', result);
});
```

### 方法2：查看执行日志
1. 微信开发者工具 → 云开发 → 云函数 → dailyReset → 日志
2. 查看是否有自动执行记录

### 方法3：检查数据库日志
在 `system_logs` 集合中查找：
```json
{
  "type": "daily_reset",
  "message": "每日定时重置完成，共重置X个班级",
  "trigger": "timer"
}
```

## 常见问题排查

### 1. 如果定时器仍不工作
- 检查云函数是否正确部署
- 确认触发器是否启用
- 查看云函数错误日志

### 2. 如果需要立即重置
可以使用现有的 `resetClassesStatus` 云函数：
```javascript
wx.cloud.callFunction({
  name: 'resetClassesStatus',
  data: {}
});
```

### 3. 检查权限问题
确保云函数有数据库读写权限。

## 预期结果

部署成功后，系统将：
- 每天0点自动执行重置
- 将所有班级状态设为0（未放学）
- 在 system_logs 中记录执行日志
- 更新班级的 updateTime 和 updatedBy 字段